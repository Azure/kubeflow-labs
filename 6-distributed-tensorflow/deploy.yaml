apiVersion: tensorflow.org/v1alpha1
kind: TfJob
metadata:
  name: distributed-mnist-lr-0001
spec:
  tensorboard:
    logDir: /tmp/tensorflow/16/logs
    serviceType: LoadBalancer
    volumes:
      - name: azurefile
        azureFile:
            secretName: azure-secret
            shareName: tensorflow3
    volumeMounts:
      - mountPath: /tmp/tensorflow #This could be any other path. All that maters is that LogDir reflects it.
        name: azurefile
  replicaSpecs:
    - replicas: 1
      tfReplicaType: MASTER
      template:
        spec:
          volumes:
            - name: azurefile
              azureFile:
                  secretName: azure-secret
                  shareName: tensorflow3
                  readOnly: false
          containers:
            - image: wbuchwalter/dist-mnist             
              name: tensorflow
              imagePullPolicy: Always
              volumeMounts:
                - mountPath: /tmp/tensorflow
                  subPath: "16/"
                  name: azurefile
          restartPolicy: OnFailure
    - replicas: 2
      tfReplicaType: WORKER
      template:
        spec:
          containers:
            - image: wbuchwalter/dist-mnist              
              name: tensorflow
              imagePullPolicy: Always
          restartPolicy: OnFailure
    - replicas: 1
      tfReplicaType: PS
---
apiVersion: tensorflow.org/v1alpha1
kind: TfJob
metadata:
  name: distributed-mnist-lr-001
spec:
  tensorboard:
    logDir: /tmp/tensorflow/16/logs
    serviceType: LoadBalancer
    volumes:
      - name: azurefile
        azureFile:
            secretName: azure-secret
            shareName: tensorflow3
    volumeMounts:
      - mountPath: /tmp/tensorflow #This could be any other path. All that maters is that LogDir reflects it.
        name: azurefile
  replicaSpecs:
    - replicas: 1
      tfReplicaType: MASTER
      template:
        spec:
          volumes:
            - name: azurefile
              azureFile:
                  secretName: azure-secret
                  shareName: tensorflow3
                  readOnly: false
          containers:
            - image: wbuchwalter/dist-mnist
              args:
                - --lr
                - "0.001"                
              name: tensorflow
              imagePullPolicy: Always
              volumeMounts:
                - mountPath: /tmp/tensorflow
                  subPath: "16/"
                  name: azurefile
          restartPolicy: OnFailure
    - replicas: 2
      tfReplicaType: WORKER
      template:
        spec:
          containers:
            - image: wbuchwalter/dist-mnist
              args:
                - --lr
                - "0.001"                          
              name: tensorflow
              imagePullPolicy: Always
          restartPolicy: OnFailure
    - replicas: 1
      tfReplicaType: PS
---
apiVersion: tensorflow.org/v1alpha1
kind: TfJob
metadata:
  name: distributed-mnist-lr-1
spec:
  tensorboard:
    logDir: /tmp/tensorflow/17/logs
    serviceType: LoadBalancer
    volumes:
      - name: azurefile
        azureFile:
            secretName: azure-secret
            shareName: tensorflow3
    volumeMounts:
      - mountPath: /tmp/tensorflow #This could be any other path. All that maters is that LogDir reflects it.
        name: azurefile
  replicaSpecs:
    - replicas: 1
      tfReplicaType: MASTER
      template:
        spec:
          volumes:
            - name: azurefile
              azureFile:
                  secretName: azure-secret
                  shareName: tensorflow3
                  readOnly: false
          containers:
            - image: wbuchwalter/dist-mnist
              args:
                - --lr
                - "1"          
              name: tensorflow
              imagePullPolicy: Always
              volumeMounts:
                - mountPath: /tmp/tensorflow
                  subPath: "17/"
                  name: azurefile
          restartPolicy: OnFailure
    - replicas: 2
      tfReplicaType: WORKER
      template:
        spec:
          containers:
            - image: wbuchwalter/dist-mnist  
               args:
                - --lr
                - "1"               
              name: tensorflow
              imagePullPolicy: Always
          restartPolicy: OnFailure
    - replicas: 1
      tfReplicaType: PS