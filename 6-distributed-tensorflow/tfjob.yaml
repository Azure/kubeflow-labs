apiVersion: tensorflow.org/v1alpha1
kind: TfJob
metadata:
  name: distributed-tfjob-azure
spec:
  tensorboard:
    logDir: /tmp/tensorflow/
    serviceType: LoadBalancer
    volumes:
      - name: azurefile
        azureFile:
            secretName: azure-secret
            shareName: tensorflow3
    volumeMounts:
      - mountPath: /tmp/tensorflow #This could be any other path. All that maters is that LogDir reflects it.
        name: azurefile
  replicaSpecs:
    - replicas: 1
      tfReplicaType: MASTER
      template:
        spec:
          volumes:
            - name: azurefile
              azureFile:
                  secretName: azure-secret
                  shareName: tensorflow3
                  readOnly: false
          containers:
            - image: wbuchwalter/distributed-sample
              args: 
                - --logdir
                - /app/logs
              name: tensorflow
              imagePullPolicy: Always
              volumeMounts:
                - mountPath: /app/logs
                  name: azurefile
          restartPolicy: OnFailure
    - replicas: 2
      tfReplicaType: WORKER
      template:
        spec:
          containers:
            - image: wbuchwalter/distributed-sample
              args: 
                - --logdir
                - /app/logs
              name: tensorflow
              imagePullPolicy: Always
          restartPolicy: OnFailure
    - replicas: 1
      tfReplicaType: PS
      template:
        spec:
          containers:
            - image: wbuchwalter/distributed-sample
              args: 
                - --logdir
                - /app/logs
              name: tensorflow
              imagePullPolicy: Always
          restartPolicy: OnFailure